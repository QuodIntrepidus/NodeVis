(()=>{"use strict";class e{constructor(){this.graph={nodes:[],edges:[],nodeDegrees:{}},this.all_components=null,this.indexMap=null,this.hashval=null}genHash(){return(JSON.stringify(this.graph.nodes.map((e=>e.id)))+JSON.stringify(this.graph.edges.map((e=>e.source.id+e.target.id)))).split("").reduce((function(e,t){return 0|(e<<5)-e+t.charCodeAt(0)}),0)}computeAverageNodeDegree(){console.log(this.graph.nodeDegrees);let e=Object.values(this.graph.nodeDegrees);return e.reduce(((e,t)=>e+t))/e.length}setIndexMap(){let e=new Map;return this.graph.nodes.forEach(((t,n)=>{t.neighbors=[],e.set(t.id,n)})),this.graph.edges.forEach((t=>{let n=e.get(t.source),d=e.get(t.target);this.graph.nodes[n].neighbors.push(d),this.graph.nodes[d].neighbors.push(n)})),this.indexMap=e,e}computeConnectedComponents(){this.setIndexMap();let e=new Set,t=t=>{e.add(t);let n=new Set;n.add(t);let d=[t];for(;d.length>0;){let t=d.pop();this.graph.nodes[t].neighbors.forEach((t=>{e.has(t)||(e.add(t),n.add(t),d.unshift(t))}))}return n},n=[],d=0;return this.graph.nodes.forEach(((o,a)=>{if(!e.has(a)){d+=1;let e=t(a);n.push(e)}})),this.all_components=n,d}computeGraphDensity(){let e=this.graph.nodes.length,t=this.graph.edges.length;return e<=1?(console.log("Density undefined"),0):2*t/(e*(e-1))}computeLargestComponent(){return this.all_components||this.computeConnectedComponents(),this.all_components.sort(((e,t)=>t.size-e.size)),this.all_components[0]}extractLargestComponent(){const e=this.computeLargestComponent(),t=this.indexMap;let n=this.graph.nodes.filter((n=>e.has(t.get(n.id)))),d=this.graph.edges.filter((n=>e.has(t.get(n.source))&&e.has(t.get(n.target))));var o=Object();for(let e=0;e<n.length;e++){var a=n[e];o[a.id]=0;for(let e=0;e<d.length;e++)d[e].source!==a.id&&d[e].source!==a.id||(o[a.id]+=1)}return{nodes:n,edges:d,nodeDegrees:o}}findLargestConnectedComponent(){return this.extractLargestComponent()}computeSSSP(e,t){let n=[e],d=new Set;d.add(e);let o=t.map((()=>-1));for(o[e]=0;n.length>0;){let e=n.pop();t[e].neighbors.forEach((t=>{d.has(t)||(o[t]=o[e]+1,d.add(t),n.unshift(t))}))}return o}computeAPSP(){this.all_components||this.computeConnectedComponents(),this.hashval=this.genHash();const e=this.graph.nodes;return this.apsp=e.map(((t,n)=>this.computeSSSP(n,e)))}computeDiameter(){return this.computeAPSP(),Math.max(...this.apsp.flat())}findGraphDiameter(){return this.computeDiameter()}computeAPL(){let e=this.computeAPSP(),t=e.flat().filter((e=>-1!=e)).length-e.length;return e.flat().filter((e=>-1!=e)).reduce(((e,t)=>e+t))/t}convertHierarchialData(){let e=[];for(let d=0;d<this.graph.nodes.length;d++){var t={node_id:this.graph.nodes[d].id,imports:[],group:""},n=Object.keys(this.graph.nodes[d]);for(let e=0;e<n.length;e++)"id"!=n[e]&&(t[n[e]]=this.graph.nodes[d][n[e]]);let o=this.graph.edges.filter((e=>e.source==this.graph.nodes[d].id?e.target:e.target==this.graph.nodes[d].id?e.source:void 0)).map((e=>e.source==this.graph.nodes[d].id?e.target:e.target==this.graph.nodes[d].id?e.source:void 0));t.imports=o,Object.keys(this.graph.nodes[d]).includes("group")&&("new"==this.graph.nodes[d].group&&(t.duration=0),t.group=this.graph.nodes[d].group),e.push(t)}return e}}function t(t,a){d3.select("#graphviz svg").remove();let r=new e;r.graph=t;for(let e=0;e<r.graph.nodes.length;e++){let t=r.graph.nodes[e].cast_name.split(",");r.graph.nodes[e].cast_name=t;let n=r.graph.nodes[e].director_name.split(",");r.graph.nodes[e].director_name=n;let d=r.graph.nodes[e].writter_name.split(",");r.graph.nodes[e].writter_name=d;let o=r.graph.nodes[e].genre.split(",");r.graph.nodes[e].genre=o;for(let t=0;t<r.graph.nodes.length;t++)a[e].id==r.graph.nodes[t].id&&(r.graph.nodes[t].img_link=a[e].large_img_link,r.graph.nodes[t].small_img_link=a[e].small_img_link)}o(r),n(r),document.getElementById("layout-toggle").addEventListener("change",(e=>{document.getElementById("node-search").value="",e.currentTarget.checked?(d3.select("#graphviz svg").remove(),document.getElementById("layout-name").textContent="Hierarchial Edge Bundling",d(r)):(d3.select("#graphviz svg").remove(),document.getElementById("layout-name").textContent="Force-Directed",n(r))}))}function n(t){o(t),d3.select("#graphviz svg").remove(),document.getElementById("dropdown-menu").replaceChildren(),document.getElementById("comp-toggle").checked=!1;var d=t.graph,a=!1;let r=t.findLargestConnectedComponent(),i=new e;i.graph=r;var s=t.graph.edges.map((e=>({...e}))),l=t.graph.nodes.map((e=>({...e})));const c=window.innerWidth,u=95*window.innerHeight/100,g=d3.forceSimulation(l).force("link",d3.forceLink(s).distance(20).id((e=>e.id))).force("charge",d3.forceManyBody().strength(-70)).force("x",d3.forceX(window.innerWidth/2)).force("y",d3.forceY(window.innerHeight/2)).on("tick",(function(){p.attr("x1",(e=>e.source.x)).attr("y1",(e=>e.source.y)).attr("x2",(e=>e.target.x)).attr("y2",(e=>e.target.y)),f.attr("cx",(e=>e.x)).attr("cy",(e=>e.y))})),m=d3.select("#graphviz").append("svg").attr("width",c).attr("height",u).attr("viewBox",[0,0,c,u]).attr("style","max-width: 100%; height: auto;"),p=m.append("g").selectAll().data(s).join("line").attr("stroke","#e0dede").attr("stroke-opacity","0.4"),f=m.append("g").attr("stroke","#fff").attr("stroke-width",1.5).selectAll().data(l).join("circle").attr("r",6).attr("fill",(e=>"new"==e.group?"#2effbd":"updated"==e.group?"#ff5100":"#b36bff")).attr("id",(e=>e.id));f.append("title").text((e=>e.id));const h=document.getElementById("movieName"),y=document.getElementById("moviePoster"),v=document.getElementById("movieRank"),k=document.getElementById("releaseYear"),b=document.getElementById("imdbRating"),w=document.getElementById("durationTime"),E=document.getElementById("genre"),x=document.getElementById("directorName"),_=document.getElementById("movieID");f.on("mouseover",((e,t)=>{h.textContent=t.name,y.style.visibility="true",y.src=t.img_link,v.textContent=t.rank,k.textContent=t.year,b.textContent=t.imdb_rating,w.textContent=t.duration,E.textContent=t.genre.join(", "),x.textContent=t.director_name.join(", "),_.textContent=t.id,f.attr("r",(e=>e.id==t.id?7.5:6))})).on("mouseout",((e,t)=>{h.textContent="Hover Over Node",y.style.visibility="false",y.src="",v.textContent="Hover Over Node",k.textContent="Hover Over Node",b.textContent="Hover Over Node",w.textContent="Hover Over Node",E.textContent="Hover Over Node",x.textContent="Hover Over Node",_.textContent="Hover Over Node",f.attr("r",(()=>6))})),f.on("click",((e,o)=>{a=!0,document.getElementById(o.id).style.fill="#b36bff",f.attr("fill","#fff").on("mouseover",((e,t)=>{const n=document.getElementById(t.id);t.id!=o.id&&(n.style.fill="#000")})).on("mouseout",((e,t)=>{const n=document.getElementById(t.id);t.id!=o.id&&(n.style.fill="#fff")})),f.on("click",((e,r)=>{if(a=!1,o.id==r.id)window.alert("Self-loops not supported in current version!");else if(d.edges.find((e=>e.source==o.id&&e.target==r.id))||d.edges.find((e=>e.source==r.id&&e.target==o.id)))window.alert("Edge already exists!");else{const e={source:o.id,target:r.id,group:"new"};d.edges.push(e);for(let e in d.nodeDegrees)e!=o.id&&e!=r.id||(d.nodeDegrees[e]+=1);for(let e in d.nodes)"updated"==d.nodes[e].group&&(d.nodes[e].group=""),d.nodes[e].id!=o.id&&d.nodes[e].id!=r.id||(d.nodes[e].group="updated")}n(t)}))})),f.call(d3.drag().on("start",(function(e){e.active||g.alphaTarget(.5).restart(),e.subject.fx=e.subject.x,e.subject.fy=e.subject.y})).on("drag",(function(e){e.subject.fx=e.x,e.subject.fy=e.y})).on("end",(function(e){e.active||g.alphaTarget(0),e.subject.fx=null,e.subject.fy=null}))),f.on("contextmenu",((e,o)=>{e.preventDefault();var a=d3.pointer(e),r=d3.select("#context_menu_node");r.style("position","absolute").style("left",a[0]+"px").style("top",a[1]-20+"px").style("display","block"),d3.selectAll("body").on("click",(e=>{r.style("display","none")}));var i=d3.select("#modify_node_button"),s=d3.select("#delete_node_button"),l=d3.select("#delete_edge_button");i.on("click",(e=>{var a=document.getElementById("node-box").style;a.backgroundColor="black";var r=d3.select("#change_node");r.style("display","block");var i=new RegExp("^(?:[^,]+,)*[^,]+$"),s=document.getElementById("mod_movName"),l=document.getElementById("mod_movRank"),c=document.getElementById("mod_id"),u=document.getElementById("mod_cast"),g=document.getElementById("mod_writer"),m=document.getElementById("mod_genre"),p=document.getElementById("mod_dir");h.textContent=s.value=o.name,y.style.visibility="true",y.src=o.img_link,v.textContent=l.value=o.rank,k.textContent=o.year,b.textContent=o.imdb_rating,w.textContent=o.duration,E.textContent=m.value=o.genre.join(", "),x.textContent=p.value=o.director_name.join(", "),_.textContent=c.value=o.id,u.value=o.cast_name.join(", "),g.value=o.writter_name.join(", "),s.addEventListener("keyup",(function(e){h.textContent=e.target.value})),l.addEventListener("keyup",(function(e){v.textContent=e.target.value})),c.addEventListener("keyup",(function(e){_.textContent=e.target.value})),u.addEventListener("keyup",(function(e){i.test(e.target.value)?u.style.color="black":u.style.color="red"})),g.addEventListener("keyup",(function(e){i.test(e.target.value)?g.style.color="black":g.style.color="red"})),m.addEventListener("keyup",(function(e){E.textContent=e.target.value,i.test(e.target.value)?m.style.color="black":m.style.color="red"})),p.addEventListener("keyup",(function(e){p.textContent=e.target.value,i.test(e.target.value)?p.style.color="black":p.style.color="red"})),d3.select("#close-con").on("click",(e=>{if(i.test(m.value)&i.test(p.value)&i.test(u.value)&i.test(g.value)){for(let e=0;e<d.nodes.length;e++)if(d.nodes[e].id==o.id){var f=d.nodes[e],h=d.nodes[e].id;if(f.name=s.value,f.rank=l.value,f.id=c.value,f.genre=m.value.split(", "),f.director_name=p.value.split(", "),f.cast_name=u.value.split(", "),f.writter_name=g.value.split(", "),f.group="updated",c.value!=h){for(let e=0;e<d.edges.length;e++)d.edges[e].source==h?d.edges[e].source=c.value:d.edges[e].target==h&&(d.edges[e].target=c.value);let e=Object.keys(d.nodeDegrees);for(let t=0;t<e.length;t++)if(e==h){var y=d.nodeDegrees[h];delete d.nodeDegrees[h],d.nodeDegrees[c.value]=y}n(t)}}r.style("display","none"),a.backgroundColor="#25252559",n(t)}else window.alert("One of your inputs is invalid. Please correct it before closing this window!")}))})),s.on("click",(e=>{if(window.confirm("Are you sure you want to delete this node?")){for(let e=0;e<d.nodes.length;e++)d.nodes[e].id==o.id&&d.nodes.splice(e,1);for(let e=0;e<d.edges.length;e++)d.edges[e].source!=o.id&&d.edges[e].target!=o.id||d.edges.splice(e,1)}n(t)})),l.on("click",(e=>{var a=[];for(let e=0;e<d.edges.length;e++)d.edges[e].source==o.id?a.push(d.edges[e].target):d.edges[e].target==o.id&&a.push(d.edges[e].source);f.attr("fill",(e=>e.id==o.id?"rgba(0, 0, 0, 1)":a.includes(e.id)?"rgba(179, 107, 255, 1)":"rgba(179, 107, 255, 0.3)")).attr("r",(e=>e.id==o.id||a.includes(e.id)?"7.1":"3")).attr("stroke-opacity",(e=>e.id==o.id||a.includes(e.id)?"1.6":"0.6")),f.on("click",((e,r)=>{if(a.includes(r.id)){if(window.confirm("Are you sure you want to delete this edge?")){for(let e=0;e<d.edges.length;e++)r.id!=d.edges[e].source&&r.id!=d.edges[e].target||o.id!=d.edges[e].source&&o.id!=d.edges[e].target||d.edges.splice(e,1);for(let e=0;e<d.nodes.length;e++)d.nodes[e].id!=r.id&&d.nodes[e].id!=o.id||(d.nodes[e].group="updated")}}else window.alert("Edge does not exist!"),f.attr("stroke","#fff").attr("stroke-opacity","1").attr("stroke-width",1.5).attr("r",6).attr("fill",(e=>"new"==e.group?"#2effbd":"updated"==e.group?"#ff5100":"#b36bff"));n(t)}))}))}));var I="id",C=["genre","cast_name","director_name","writter_name"];d3.select("#switchSearch").on("change",(function(e){var t=document.getElementById("searchText");7==e.target.value&&(e.target.value=0),-1==e.target.value&&(e.target.value=6),0==e.target.value?(t.innerText="ID",I="id"):1==e.target.value?(t.textContent="Rank",I="rank"):2==e.target.value?(t.innerText="Name",I="name"):3==e.target.value?(t.innerText="Genre",I="genre"):4==e.target.value?(t.innerText="Cast Name",I="cast_name"):5==e.target.value?(t.innerText="Director Name",I="director_name"):6==e.target.value&&(t.innerText="Writer Name",I="writter_name");var n=new Set;if(C.includes(I))for(let e=0;e<d.nodes.length;e++)for(var o=0;o<d.nodes[e][I].length;o++)n.add(d.nodes[e][I][o]);else for(let e=0;e<d.nodes.length;e++)n.add(d.nodes[e][I]);let a=document.getElementById("dropdown-menu");if(a.innerHTML="",!a.children.length>=1)for(let e=0;e<n.size;e++){var r=Array.from(n)[e],i=r.split(" ").join("_"),s=document.createElement("a");s.classList.add("node-dropdown"),s.setAttribute("id","node-"+i),s.textContent=r,a.appendChild(s)}})),document.getElementById("comp-toggle").addEventListener("change",(e=>{if(a)return window.alert("Please add an edge before switching layouts!"),void(document.getElementById("comp-toggle").checked=!1);document.getElementById("node-search").value="",e.target.checked?(o(i),f.attr("fill",(e=>r.nodes.map((e=>e.id)).includes(e.id)?"rgba(179, 107, 255, 1)":"rgba(179, 107, 255, 0.3)")).attr("r",(e=>r.nodes.map((e=>e.id)).includes(e.id)?"7.1":"3")).attr("stroke-opacity",(e=>r.nodes.map((e=>e.id)).includes(e.id)?"1.6":"0.6")),p.attr("stroke-opacity",(e=>{let t=r.nodes.map((e=>e.id));return t.includes(e.source.id)||t.includes(e.target.id)?"0.5":"0.1"})).attr("stroke",(e=>{let t=r.nodes.map((e=>e.id));return t.includes(e.source.id)||t.includes(e.target.id)?"#fff":"#e0dede"}))):(o(t),f.attr("fill",(e=>"new"==e.group?"#2effbd":"updated"==e.group?"#ff5100":"#b36bff")).attr("r","6").attr("stroke-opacity","1"),p.attr("stroke-opacity","0.4").attr("stroke",(e=>{let t=r.nodes.map((e=>e.id));return t.includes(e.source.id)||t.includes(e.target.id)?"#fff":"#e0dede"})))}));const B=document.getElementById("dropdown-menu");if(!B.children.length>=1)for(let e=0;e<d.nodes.length;e++){var D=document.createElement("a");D.classList.add("node-dropdown"),D.setAttribute("id","node-"+d.nodes[e][I]),D.textContent=d.nodes[e][I],B.appendChild(D)}d3.select("#add-node").on("click",(function(e){if(""==document.getElementById("node-name").value)window.alert("Add a node name first!");else if(d.nodes.some((e=>e.id==document.getElementById("node-name").value)))window.alert("This node already exists!");else{const e={id:document.getElementById("node-name").value,group:"new"};d.nodeDegrees[document.getElementById("node-name").value]=0,document.getElementById("node-name").value="",d.nodes.push(e),n(t)}})),d3.select("#node-search").on("keyup",(function(e){if(a)return window.alert("Please add an edge before searching for nodes!"),document.getElementById("node-search").value="",void B.classList.toggle("show");1==document.getElementById("comp-toggle").checked&&(document.getElementById("comp-toggle").checked=!1,f.attr("fill",(e=>"new"==e.group?"#2effbd":"updated"==e.group?"#ff5100":"#b36bff")).attr("r","6").attr("stroke-opacity","1"),p.attr("stroke-opacity","0.4").attr("stroke",(e=>{let t=r.nodes.map((e=>e.id));return t.includes(e.source.id)||t.includes(e.target.id)?"#fff":"#e0dede"}))),document.getElementById("dropdown-menu").classList.contains("show")||document.getElementById("dropdown-menu").classList.toggle("show"),d.nodes.some((e=>e.id===this.value))||f.attr("r",6).attr("stroke-opacity",1).attr("fill",(e=>"new"==e.group?"#2effbd":"updated"==e.group?"#ff5100":"#b36bff"))})).on("click",(function(e){if(a)return window.alert("Please add an edge before searching for nodes!"),void(document.getElementById("node-search").value="");B.classList.toggle("show"),d3.selectAll("a.node-dropdown").on("click",(function(e){var t=d3.select(this).attr("id").replace("node-","").split("_").join(" ");document.getElementById("node-search").value=t,B.classList.toggle("show"),f.attr("fill",(e=>C.includes(I)?e[I].includes(t)?"rgba(179, 107, 255, 1)":("new"==e.group||e.group,"rgba(0, 0, 0, 0.4)"):e[I]===t?"rgba(179, 107, 255, 1)":("new"==e.group||e.group,"rgba(0, 0, 0, 0.4)"))).attr("r",(e=>C.includes(I)?e[I].includes(t)?10:6:e[I]===t?10:6)).attr("stroke-opacity",.5)}))}))}function d(e){o(e),d3.select("#graphviz svg").remove(),document.getElementById("dropdown-menu").replaceChildren(),document.getElementById("comp-toggle").checked=!1;var t=!1,n=e.graph;let a=e.findLargestConnectedComponent(),r=e.convertHierarchialData(),i=d3.cluster().size([360,340]);var s=d3.select("#graphviz").append("svg").attr("width",880).attr("height",880).append("g").attr("transform","translate(440,440)");let l=s.append("g").selectAll(".link"),c=s.append("g").selectAll(".node"),u=function(e){var t={};function n(e,d){var o,a=t[e];return a||(a=t[e]=d||{id:e,children:[]},e.length&&(a.parent=n(e.substring(0,o=e.lastIndexOf("."))),a.parent.children.push(a),a.key=e.substring(o+1))),a}return e.forEach((function(e){n(e.node_id,e)})),d3.hierarchy(t[""])}(r).sum((function(e){return e.duration}));var g,m,p;i(u),l=l.data((g=u.leaves(),m={},p=[],g.forEach((function(e){m[e.data.node_id]=e})),g.forEach((function(e){e.data.imports&&e.data.imports.forEach((function(t){p.push(m[e.data.node_id].path(m[t]))}))})),p)).enter().append("path").each((function(e){e.source=e[0],e.target=e[e.length-1]})).attr("class","link").attr("stroke",(e=>"updated"==e.source.data.group&&"updated"==e.target.data.group?"#ff5100":"#b5b5b5")).attr("stroke-opacity",.4).each((function(e,t){d3.select(this).attr("d",function(){let e=1.5+.2*Math.random();return d3.lineRadial().curve(d3.curveBundle.beta(e)).radius((function(e){return e.y})).angle((function(e){return e.x/180*Math.PI}))}())})),c=c.data(u.leaves()).enter().append("text").attr("class","node").attr("dy","0.31em").attr("transform",(function(e){return"rotate("+(e.x-90)+")translate("+(e.y+8)+",0)"+(e.x<180?"":"rotate(180)")})).attr("text-anchor",(function(e){return e.x<180?"start":"end"})).text((function(e){return e.data.key})).attr("fill",(e=>"new"==e.data.group?"#2effbd":"updated"==e.data.group?"#ff5100":"#b36bff")).attr("id",(e=>e.data.key)),c.on("mouseover",((e,t)=>{const n=document.getElementById("movieName"),d=document.getElementById("moviePoster"),o=document.getElementById("movieRank"),a=document.getElementById("releaseYear"),r=document.getElementById("imdbRating"),i=document.getElementById("durationTime"),s=document.getElementById("genre"),l=document.getElementById("directorName"),u=document.getElementById("movieID");n.textContent=t.data.name,d.style.visibility="true",d.src=t.data.img_link,o.textContent=t.data.rank,a.textContent=t.data.year,r.textContent=t.data.imdb_rating,i.textContent=t.data.duration,s.textContent=t.data.genre.join(", "),l.textContent=t.data.director_name.join(", "),u.textContent=t.data.node_id,c.attr("r")})).on("mouseout",((e,t)=>{const n=document.getElementById("movieName"),d=document.getElementById("moviePoster"),o=document.getElementById("movieRank"),a=document.getElementById("releaseYear"),r=document.getElementById("imdbRating"),i=document.getElementById("durationTime"),s=document.getElementById("genre"),l=document.getElementById("directorName"),c=document.getElementById("movieID");n.textContent="Hover Over Node",d.style.visibility="false",d.src="",o.textContent="Hover Over Node",a.textContent="Hover Over Node",r.textContent="Hover Over Node",i.textContent="Hover Over Node",s.textContent="Hover Over Node",l.textContent="Hover Over Node",c.textContent="Hover Over Node"})),c.on("click",((o,a)=>{t=!0,document.getElementById(a.data.key).style.fill="#b36bff",c.attr("fill","#fff").on("mouseover",((e,t)=>{const n=document.getElementById(t.data.key);t.data.key!=a.data.key&&(n.style.fill="#000"),a.data.imports.includes(t.data.key)&&(n.style.fill="#fa2d2d")})).on("mouseout",((e,t)=>{const n=document.getElementById(t.data.key);t.data.key!=a.data.key&&(n.style.fill="#fff")})),l.attr("stroke-opacity",(e=>e.source.data.key===a.data.key||e.target.data.key===a.data.key?"0.4":"0")),c.on("click",((o,r)=>{if(t=!1,a.data.key==r.data.key)window.alert("Self-loops not supported in current version!");else if(n.edges.find((e=>e.source==a.data.key&&e.target==r.data.key))||n.edges.find((e=>e.source==r.data.key&&e.target==a.data.key)))window.alert("Edge already exists!");else{const e={source:a.data.key,target:r.data.key};n.edges.push(e);for(let e in n.nodeDegrees)e!=a.data.key&&e!=r.data.key||(n.nodeDegrees[e]+=1);for(let e in n.nodes)"updated"==n.nodes[e].group&&(n.nodes[e].group=""),n.nodes[e].id!=a.data.key&&n.nodes[e].id!=r.data.key||(n.nodes[e].group="updated")}d(e)}))})),c.on("contextmenu",((t,o)=>{t.preventDefault(),d3.pointer(t),console.log(t);var a=d3.select("#context_menu_node");a.style("position","absolute").style("left",t.clientX+10+"px").style("top",t.clientY+10+"px").style("display","block"),d3.selectAll("body").on("click",(e=>{a.style("display","none")}));var r=d3.select("#modify_node_button"),i=d3.select("#delete_node_button"),s=d3.select("#delete_edge_button");r.on("click",(t=>{var a=document.getElementById("node-box").style;a.backgroundColor="black";var r=d3.select("#change_node");r.style("display","block");var i=new RegExp("^(?:[^,]+,)*[^,]+$"),s=document.getElementById("mod_movName"),l=document.getElementById("mod_movRank"),c=document.getElementById("mod_id"),u=document.getElementById("mod_cast"),g=document.getElementById("mod_writer"),m=document.getElementById("mod_genre"),p=document.getElementById("mod_dir");movieName.textContent=s.value=o.data.name,moviePoster.style.visibility="true",moviePoster.src=o.data.img_link,movieRank.textContent=l.value=o.data.rank,releaseYear.textContent=o.data.year,imdbRating.textContent=o.data.imdb_rating,durationTime.textContent=o.data.duration,genre.textContent=m.value=o.data.genre.join(", "),directorName.textContent=p.value=o.data.director_name.join(", "),movieID.textContent=c.value=o.data.node_id,u.value=o.data.cast_name.join(", "),g.value=o.data.writter_name.join(", "),s.addEventListener("keyup",(function(e){movieName.textContent=e.target.value})),l.addEventListener("keyup",(function(e){movieRank.textContent=e.target.value})),c.addEventListener("keyup",(function(e){movieID.textContent=e.target.value})),u.addEventListener("keyup",(function(e){i.test(e.target.value)?u.style.color="black":u.style.color="red"})),g.addEventListener("keyup",(function(e){i.test(e.target.value)?g.style.color="black":g.style.color="red"})),m.addEventListener("keyup",(function(e){genre.textContent=e.target.value,i.test(e.target.value)?m.style.color="black":m.style.color="red"})),p.addEventListener("keyup",(function(e){p.textContent=e.target.value,i.test(e.target.value)?p.style.color="black":p.style.color="red"})),d3.select("#close-con").on("click",(t=>{if(i.test(m.value)&i.test(p.value)&i.test(u.value)&i.test(g.value)){for(let t=0;t<n.nodes.length;t++)if(n.nodes[t].id==o.data.node_id){var f=n.nodes[t],h=n.nodes[t].id;if(f.name=s.value,f.rank=l.value,f.id=c.value,f.genre=m.value.split(", "),f.director_name=p.value.split(", "),f.cast_name=u.value.split(", "),f.writter_name=g.value.split(", "),f.group="updated",c.value!=h){for(let e=0;e<n.edges.length;e++)n.edges[e].source==h?n.edges[e].source=c.value:n.edges[e].target==h&&(n.edges[e].target=c.value);let t=Object.keys(n.nodeDegrees);for(let e=0;e<t.length;e++)if(t==h){var y=n.nodeDegrees[h];delete n.nodeDegrees[h],n.nodeDegrees[c.value]=y}d(e)}}r.style("display","none"),a.backgroundColor="#25252559",d(e)}else window.alert("One of your inputs is invalid. Please correct it before closing this window!")}))})),i.on("click",(t=>{if(window.confirm("Are you sure you want to delete this node?")){for(let e=0;e<n.nodes.length;e++)n.nodes[e].id==o.data.node_id&&n.nodes.splice(e,1);for(let e=0;e<n.edges.length;e++)n.edges[e].source!=o.data.node_id&&n.edges[e].target!=o.data.node_id||n.edges.splice(e,1)}d(e)})),s.on("click",(t=>{var a=[];for(let e=0;e<n.edges.length;e++)n.edges[e].source==o.data.node_id?a.push(n.edges[e].target):n.edges[e].target==o.data.node_id&&a.push(n.edges[e].source);c.attr("fill",(e=>e.data.node_id==o.data.node_id?"rgba(0, 0, 0, 1)":a.includes(e.data.node_id)?"rgba(179, 107, 255, 1)":"rgba(179, 107, 255, 0.3)")).attr("r",(e=>e.data.node_id==o.data.node_id||a.includes(e.data.node_id)?"7.1":"3")).attr("stroke-opacity",(e=>e.data.node_id==o.data.node_id||a.includes(e.data.node_id)?"1.6":"0.6")),l.attr("stroke-opacity",(e=>o.data.node_id==e.source.data.node_id&&a.includes(e.target.data.node_id)||o.data.node_id==e.target.data.node_id&&a.includes(e.source.data.node_id)?"0.6":"0")),c.on("click",((t,r)=>{if(a.includes(r.data.node_id)){if(window.confirm("Are you sure you want to delete this edge?")){for(let e=0;e<n.edges.length;e++)r.data.node_id!=n.edges[e].source&&r.data.node_id!=n.edges[e].target||o.data.node_id!=n.edges[e].source&&o.data.node_id!=n.edges[e].target||n.edges.splice(e,1);for(let e=0;e<n.nodes.length;e++)n.nodes[e].id!=r.data.node_id&&n.nodes[e].id!=o.data.node_id||(n.nodes[e].group="updated")}}else window.alert("Edge does not exist!"),c.attr("stroke","#fff").attr("stroke-opacity","1").attr("stroke-width",1.5).attr("r",6).attr("fill",(e=>"new"==e.data.group?"#2effbd":"updated"==e.data.group?"#ff5100":"#b36bff")),l.attr("stroke-opacity",.6);d(e)}))}))}));var f="id",h=["genre","cast_name","director_name","writter_name"];d3.select("#switchSearch").on("change",(function(e){var t=document.getElementById("searchText");7==e.target.value&&(e.target.value=0),-1==e.target.value&&(e.target.value=6),0==e.target.value?(t.innerText="ID",f="id"):1==e.target.value?(t.textContent="Rank",f="rank"):2==e.target.value?(t.innerText="Name",f="name"):3==e.target.value?(t.innerText="Genre",f="genre"):4==e.target.value?(t.innerText="Cast Name",f="cast_name"):5==e.target.value?(t.innerText="Director Name",f="director_name"):6==e.target.value&&(t.innerText="Writer Name",f="writter_name");var d=new Set;if(h.includes(f))for(let e=0;e<n.nodes.length;e++)for(var o=0;o<n.nodes[e][f].length;o++)d.add(n.nodes[e][f][o]);else for(let e=0;e<n.nodes.length;e++)d.add(n.nodes[e][f]);let a=document.getElementById("dropdown-menu");if(a.innerHTML="",!a.children.length>=1)for(let e=0;e<d.size;e++){var r=Array.from(d)[e],i=r.split(" ").join("_"),s=document.createElement("a");s.classList.add("node-dropdown"),s.setAttribute("id","node-"+i),s.textContent=r,a.appendChild(s)}})),document.getElementById("comp-toggle").addEventListener("change",(e=>{if(t)return window.alert("Please add an edge before switching layouts!"),void(document.getElementById("comp-toggle").checked=!1);document.getElementById("node-search").value="",e.target.checked?(c.attr("fill",(e=>a.nodes.map((e=>e.id)).includes(e.data.key)?"rgba(179, 107, 255, 1)":"rgba(179, 107, 255, 0.3)")),l.attr("stroke-opacity",(e=>{let t=a.nodes.map((e=>e.id));return t.includes(e.source.data.key)||t.includes(e.target.data.key)?"0.4":"0"})).attr("stroke","#b5b5b5")):(c.attr("fill",(e=>"new"==e.data.group?"#2effbd":"updated"==e.data.group?"#ff5100":"#b36bff")).attr("r","6").attr("stroke-opacity","1"),l.attr("stroke-opacity","0.4").attr("stroke",(e=>"updated"==e.source.data.group&&"updated"==e.target.data.group?"#ff5100":"#b5b5b5")))}));const y=document.getElementById("dropdown-menu");if(!y.children.length>=1)for(let e=0;e<n.nodes.length;e++){var v=document.createElement("a");v.classList.add("node-dropdown"),v.setAttribute("id","node-"+n.nodes[e].id),v.textContent=n.nodes[e].id,y.appendChild(v)}d3.select("#add-node").on("click",(function(t){if(""==document.getElementById("node-name").value)window.alert("Add a node name first!");else if(n.nodes.some((e=>e.id==document.getElementById("node-name").value)))window.alert("This node already exists!");else{const t={id:document.getElementById("node-name").value,group:"new"};n.nodeDegrees[document.getElementById("node-name").value]=0,document.getElementById("node-name").value="",n.nodes.push(t),d(e)}})),d3.select("#node-search").on("keyup",(function(e){if(t)return window.alert("Please add an edge before searching for nodes!"),document.getElementById("node-search").value="",void y.classList.toggle("show");1==document.getElementById("comp-toggle").checked&&(document.getElementById("comp-toggle").checked=!1,c.attr("fill",(e=>"new"==e.data.group?"#2effbd":"updated"==e.data.group?"#ff5100":"#b36bff")).attr("r","6").attr("stroke-opacity","1"),l.attr("stroke-opacity","0.4")),document.getElementById("dropdown-menu").classList.contains("show")||document.getElementById("dropdown-menu").classList.toggle("show"),n.nodes.some((e=>e.id===this.value))||(c.attr("stroke-opacity","1").attr("fill",(e=>"new"==e.data.group?"#2effbd":"updated"==e.data.group?"#ff5100":"#b36bff")),l.attr("stroke-opacity",.4))})).on("click",(function(e){if(t)return window.alert("Please add an edge before searching for nodes!"),void(document.getElementById("node-search").value="");y.classList.toggle("show"),d3.selectAll("a.node-dropdown").on("click",(function(e){var t=d3.select(this).attr("id").replace("node-","").split("_").join(" ");document.getElementById("node-search").value=t,y.classList.toggle("show"),c.attr("fill",(e=>{var n;return n="id"==f?"node_id":f,h.includes(n)?e.data[n].includes(t)?"rgba(179, 107, 255, 1)":("new"==e.data.group||e.data.group,"rgba(0, 0, 0, 0.4)"):e.data[n]===t?"rgba(179, 107, 255, 1)":("new"==e.data.group||e.data.group,"rgba(0, 0, 0, 0.4)")})).attr("r",(e=>h.includes(id_val)?e.data[id_val].includes(t)?10:6:e.data[id_val]===t?10:6)).attr("stroke-opacity",.5)}))}))}function o(e){document.getElementById("avgDegree").textContent=e.computeAverageNodeDegree().toString(),document.getElementById("numComponents").textContent=e.computeConnectedComponents().toString(),document.getElementById("graphDensity").textContent=e.computeGraphDensity().toString(),document.getElementById("graphDiameter").textContent=e.findGraphDiameter().toString(),document.getElementById("apl").textContent=e.computeAPL().toString()}fetch("output_graph.json").then((e=>e.json())).then((e=>{fetch("movie-img_links.json").then((e=>e.json())).then((n=>{t(e,n)})).catch((e=>console.error("There was an error!",e)))})).catch((e=>console.error("There was an error!",e)))})();